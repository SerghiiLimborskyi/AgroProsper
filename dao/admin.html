<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ö–∞–±—ñ–Ω–µ—Ç –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ AgroProsper</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <style>
    body { font-family: Arial; background: #fffbe6; padding: 20px; }
    h1 { color: #2c3e50; }
    button { padding: 10px 20px; margin: 10px 0; }
    input { margin: 5px 0; padding: 8px; width: 300px; }
    p { font-weight: bold; }
  </style>
</head>
<body>

  <h1>üõ°Ô∏è –ö–∞–±—ñ–Ω–µ—Ç –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ AgroProsper</h1>
  <button onclick="connectWallet()">üîó –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –≥–∞–º–∞–Ω–µ—Ü—å</button>
  <p id="status">–°—Ç–∞—Ç—É—Å: –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ</p>

  <h2>üìä –ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è</h2>
  <button onclick="checkVotes()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≥–æ–ª–æ—Å–∏</button>
  <p id="adminStatus">–ì–æ–ª–æ—Å—ñ–≤: ‚Äî</p>

  <h2>üßπ –°–∫–∏–¥–∞–Ω–Ω—è –≥–æ–ª–æ—Å—ñ–≤</h2>
  <button onclick="resetVotes()">üîÑ –°–∫–∏–Ω—É—Ç–∏ –≥–æ–ª–æ—Å–∏</button>
  <p id="resetStatus">–°—Ç–∞—Ç—É—Å: ‚Äî</p>

  <h2>üíº –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞–º–∏</h2>
  <button onclick="getBalance()">üí∞ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –±–∞–ª–∞–Ω—Å</button>
  <p id="balance">–ë–∞–ª–∞–Ω—Å: ‚Äî</p>
  <input type="text" id="recipient" placeholder="–ê–¥—Ä–µ—Å–∞ –æ—Ç—Ä–∏–º—É–≤–∞—á–∞">
  <input type="number" id="amount" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–∫–µ–Ω—ñ–≤">
  <button onclick="sendTokens()">üì§ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏</button>
  <p id="tokenStatus">–°—Ç–∞—Ç—É—Å: ‚Äî</p>
  <h2>–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞ –ø–∞–Ω–µ–ª—å</h2>

<div>
  <label>–ù–æ–º–µ—Ä –≤–µ—Ä—Å—ñ—ó:</label>
  <input type="text" id="versionInput" placeholder="v1.2">
</div>
<div>
  <label>–°–ø–∏—Å–æ–∫ –∑–º—ñ–Ω:</label>
  <textarea id="changesInput" placeholder="–ü–µ—Ä–µ–ª—ñ–∫ –∑–º—ñ–Ω —á–µ—Ä–µ–∑ –∫–æ–º—É"></textarea>
</div>
<button onclick="approveUpdate()">‚úÖ –ó–∞—Ç–≤–µ—Ä–¥–∏—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</button>

<p id="statusMessage"></p>

<script src="feedback.js"></script>

  <script>
    let web3;
    let account;

    const votingAddress = "0xYourVotingContractAddress"; // –∑–∞–º—ñ–Ω–∏
    const tokenAddress = "0xYourAgroTokenAddress"; // –∑–∞–º—ñ–Ω–∏

    const votingABI = [
      { "inputs": [], "name": "resetVotes", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
      { "inputs": [{ "name": "option", "type": "uint8" }], "name": "getVotes", "outputs": [{ "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" },
      { "inputs": [], "name": "owner", "outputs": [{ "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }
    ];

    const tokenABI = [
      { "constant": true, "inputs": [{ "name": "_owner", "type": "address" }], "name": "balanceOf", "outputs": [{ "name": "balance", "type": "uint256" }], "type": "function" },
      { "constant": false, "inputs": [{ "name": "_to", "type": "address" }, { "name": "_value", "type": "uint256" }], "name": "transfer", "outputs": [{ "name": "success", "type": "bool" }], "type": "function" }
    ];

    async function connectWallet() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        try {
          const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
          account = accounts[0];
          document.getElementById('status').textContent = '‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ: ' + account;
        } catch (err) {
          document.getElementById('status').textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message;
        }
      } else {
        document.getElementById('status').textContent = '‚ùå MetaMask –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
      }
    }
const changelogAddress = "0xYourChangelogContractAddress"; // –∑–∞–º—ñ–Ω–∏
const changelogContract = new web3.eth.Contract(changelogABI, changelogAddress);

async function approveUpdate() {
  const version = document.getElementById("versionInput").value.trim();
  const changesRaw = document.getElementById("changesInput").value.trim();
  const changes = changesRaw.split(",").map(c => c.trim()).filter(c => c.length > 0);
  const date = new Date().toISOString().split("T")[0];

  if (!version || changes.length === 0) {
    document.getElementById("statusMessage").innerText = "‚ùå –í–≤–µ–¥—ñ—Ç—å –≤–µ—Ä—Å—ñ—é —Ç–∞ –∑–º—ñ–Ω–∏.";
    return;
  }

  try {
    await changelogContract.methods
      .approveVersion(version, date, changes)
      .send({ from: account });

    document.getElementById("statusMessage").innerText = `‚úÖ –í–µ—Ä—Å—ñ—è ${version} –∑–∞—Ç–≤–µ—Ä–¥–∂–µ–Ω–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω—ñ.`;
  } catch (err) {
    document.getElementById("statusMessage").innerText = "‚ùå –ü–æ–º–∏–ª–∫–∞: " + err.message;
  }
}

    async function checkVotes() {
      const contract = new web3.eth.Contract(votingABI, votingAddress);
      const yes = await contract.methods.getVotes(1).call();
      const no = await contract.methods.getVotes(2).call();
      document.getElementById('adminStatus').textContent =
        `‚úÖ –ü—ñ–¥—Ç—Ä–∏–º–∫–∞: ${yes} | ‚ùå –í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è: ${no}`;
    }

    async function isAdmin() {
      const contract = new web3.eth.Contract(votingABI, votingAddress);
      const owner = await contract.methods.owner().call();
      return owner.toLowerCase() === account.toLowerCase();
    }

    async function resetVotes() {
      if (!(await isAdmin())) {
        document.getElementById('resetStatus').textContent = '‚õî –í–∏ –Ω–µ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä';
        return;
      }
      const contract = new web3.eth.Contract(votingABI, votingAddress);
      try {
        await contract.methods.resetVotes().send({ from: account });
        document.getElementById('resetStatus').textContent = '‚úÖ –ì–æ–ª–æ—Å–∏ —Å–∫–∏–Ω—É—Ç–æ';
      } catch (err) {
        document.getElementById('resetStatus').textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message;
      }
    }

    async function getBalance() {
      const contract = new web3.eth.Contract(tokenABI, tokenAddress);
      const balance = await contract.methods.balanceOf(account).call();
      document.getElementById('balance').textContent =
        '–ë–∞–ª–∞–Ω—Å: ' + web3.utils.fromWei(balance, 'ether') + ' AGRO';
    }

    async function sendTokens() {
      const to = document.getElementById('recipient').value;
      const amount = document.getElementById('amount').value;
      const contract = new web3.eth.Contract(tokenABI, tokenAddress);
      try {
        await contract.methods.transfer(to, web3.utils.toWei(amount, 'ether')).send({ from: account });
        document.getElementById('tokenStatus').textContent = '‚úÖ –¢–æ–∫–µ–Ω–∏ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ';
      } catch (err) {
        document.getElementById('tokenStatus').textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message;
      }
    }
  </script>

</body>
</html>

// analytics.js ‚Äî DAO-–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ –¥–ª—è admin-analytics.html

document.addEventListener("DOMContentLoaded", () => {
  renderRoleChart();
  renderTitleChart();
  renderBadgeChart();
  renderEcoChart();
  renderAGTChart();
});

// üß© –†–æ–ª—ñ
function renderRoleChart() {
  const ctx = document.getElementById("roleChart").getContext("2d");
  new Chart(ctx, {
    type: "pie",
    data: {
      labels: ["–§–µ—Ä–º–µ—Ä–∏", "–ü–∞—Ä—Ç–Ω–µ—Ä–∏", "–ê–≥–µ–Ω—Ç–∏", "–ì–æ—Å—Ç—ñ"],
      datasets: [{
        data: [40, 25, 20, 15],
        backgroundColor: ["#8bc34a", "#ffcc00", "#2196f3", "#ccc"]
      }]
    }
  });
}

// ‚öñÔ∏è –¢–∏—Ç—É–ª–∏
function renderTitleChart() {
  const ctx = document.getElementById("titleChart").getContext("2d");
  new Chart(ctx, {
    type: "bar",
    data: {
      labels: ["–ó–±–µ—Ä—ñ–≥–∞—á –ó–µ–º–ª—ñ", "–ï—Ç–∏—á–Ω–∏–π –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä", "DAO-–ù–æ–≤–∞—á–æ–∫"],
      datasets: [{
        label: "–ö—ñ–ª—å–∫—ñ—Å—Ç—å",
        data: [12, 18, 6],
        backgroundColor: "#4caf50"
      }]
    }
  });
}

// üèÖ –ë–µ–π–¥–∂—ñ
function renderBadgeChart() {
  const ctx = document.getElementById("badgeChart").getContext("2d");
  const badgeLog = JSON.parse(localStorage.getItem("badgeLog") || "[]");
  const badgeCounts = countBadges(badgeLog);

  new Chart(ctx, {
    type: "doughnut",
    data: {
      labels: Object.keys(badgeCounts),
      datasets: [{
        data: Object.values(badgeCounts),
        backgroundColor: ["#66bb6a", "#ffeb3b", "#00bcd4", "#e91e63", "#9c27b0"]
      }]
    }
  });
}

function countBadges(log) {
  const counts = {};
  log.forEach(b => {
    counts[b] = (counts[b] || 0) + 1;
  });
  return counts;
}

// üåø –ï–∫–æ-–¥—ñ—ó
function renderEcoChart() {
  const ctx = document.getElementById("ecoChart").getContext("2d");
  const ecoLog = JSON.parse(localStorage.getItem("ecoActions") || "[]");

  const months = ["–í–µ—Ä–µ—Å–µ–Ω—å", "–ñ–æ–≤—Ç–µ–Ω—å", "–õ–∏—Å—Ç–æ–ø–∞–¥"];
  const plantings = [32, 45, 51];
  const restorations = [20, 28, 34];

  new Chart(ctx, {
    type: "line",
    data: {
      labels: months,
      datasets: [
        {
          label: "–ü–æ—Å–∞–¥–∫–∏",
          data: plantings,
          borderColor: "#4caf50",
          fill: false
        },
        {
          label: "–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è",
          data: restorations,
          borderColor: "#8bc34a",
          fill: false
        }
      ]
    }
  });
}

// üí∞ AGT-—Ç–æ–∫–µ–Ω–∏
function renderAGTChart() {
  const ctx = document.getElementById("agtChart").getContext("2d");
  new Chart(ctx, {
    type: "bar",
    data: {
      labels: ["–ì—Ä–∞–≤—Ü—ñ", "–ü–∞—Ä—Ç–Ω–µ—Ä–∏", "–§–æ–Ω–¥ DAO"],
      datasets: [{
        label: "AGT",
        data: [320, 480, 200],
        backgroundColor: ["#00ff99", "#ffcc00", "#ff3366"]
      }]
    }
  });
}

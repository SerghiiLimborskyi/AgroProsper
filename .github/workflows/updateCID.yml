name: ğŸ”„ Update CID for NFT Badges

on:
  workflow_dispatch:  # Ñ€ÑƒÑ‡Ğ½Ğ¸Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ· Ñ–Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑƒ GitHub
  push:
    paths:
      - 'metadata/**.json'   # Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¸ Ğ·Ğ¼Ñ–Ğ½Ñ– Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ…
      - 'scripts/cid/**.js'  # Ğ°Ğ±Ğ¾ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ–Ğ² CID

jobs:
  update-cid:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout repo
      uses: actions/checkout@v3

    - name: ğŸ§ª Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: ğŸ“¦ Install dependencies
      run: npm install

    - name: ğŸ” Load secrets
      env:
        WEB3STORAGE_TOKEN: ${{ secrets.WEB3STORAGE_TOKEN }}
      run: echo "Token loaded"

    - name: ğŸš€ Run badgeManager.js
      run: |
        node scripts/cid/badgeManager.js --all --upload --update
      env:
        WEB3STORAGE_TOKEN: ${{ secrets.WEB3STORAGE_TOKEN }}

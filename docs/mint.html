<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Mint SBT ‚Äì AgroProsper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5fff4;
      color: #222;
      text-align: center;
      padding: 2rem;
      margin: 0;
    }
    h1 {
      font-size: 1.8rem;
      color: #2e7d32;
    }
    p {
      font-size: 1rem;
      margin: 0.5rem 0;
    }
    button {
      font-size: 1.1rem;
      padding: 0.8rem 1.5rem;
      background: #34a853;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 1rem;
    }
    button:hover {
      background: #1b5e20;
    }
    img {
      margin: 2rem auto;
      display: block;
      width: 180px;
    }
    #status {
      margin-top: 1rem;
      font-weight: bold;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>ü•á Mint your <em>Top Farmer</em> SBT</h1>
  <p>Connect MetaMask and claim your non-transferable achievement!</p>
  <img src="/media-kit/badges/top-farmer.svg" alt="Top Farmer Badge" />

  <button onclick="connectWallet()">üîó –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ MetaMask</button>
  <button onclick="mintSBT()">üéñÔ∏è –ú—ñ–Ω—Ç–∏–Ω–≥ SBT</button>

  <p id="status">–í–∞—à AgroScore: <span id="score">0</span></p>

  <script>
    const contractAddress = "0xYOUR_CONTRACT_ADDRESS"; // üîÅ –í—Å—Ç–∞–≤ –∞–¥—Ä–µ—Å—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É
    const tokenURI = "ipfs://Qm.../top-farmer.json";   // üîÅ –í—Å—Ç–∞–≤ URI –º–µ—Ç–∞–¥–∞–Ω–∏—Ö
    const abi = [
      "function mintSBT(address to, string memory tokenURI) external"
    ];

    const urlParams = new URLSearchParams(window.location.search);
    const score = urlParams.get("score") || "0";
    document.getElementById("score").textContent = score;

    let signer;
    let walletAddress;

    async function connectWallet() {
      if (!window.ethereum) {
        alert("ü¶ä –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å MetaMask –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó.");
        return;
      }
      try {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        walletAddress = await signer.getAddress();
        document.getElementById("status").textContent = `‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ: ${walletAddress}`;
      } catch (err) {
        document.getElementById("status").textContent = "‚ùå –í—ñ–¥–º–æ–≤–∞ —É –¥–æ—Å—Ç—É–ø—ñ –¥–æ –≥–∞–º–∞–Ω—Ü—è.";
      }
    }

    async function mintSBT() {
      if (!signer || !walletAddress) {
        alert("üîó –°–ø–æ—á–∞—Ç–∫—É –ø—ñ–¥–∫–ª—é—á—ñ—Ç—å MetaMask.");
        return;
      }
      try {
        const contract = new ethers.Contract(contractAddress, abi, signer);
        const tx = await contract.mintSBT(walletAddress, tokenURI);
        document.getElementById("status").textContent = "‚è≥ –ú—ñ–Ω—Ç–∏–Ω–≥...";
        await tx.wait();
        document.getElementById("status").textContent = "‚úÖ SBT —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–Ω–æ!";
      } catch (err) {
        console.error(err);
        document.getElementById("status").textContent = "üö´ –ü–æ–º–∏–ª–∫–∞ –º—ñ–Ω—Ç–∏–Ω–≥—É.";
      }
    }
  </script>
</body>
</html>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.7.8/dist/umd/index.min.js"></script>
<button onclick="connectWalletConnect()">üì± –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ WalletConnect</button>
<script>
let wcProvider;

async function connectWalletConnect() {
  wcProvider = new WalletConnectProvider.default({
    rpc: {
      1: "https://mainnet.infura.io/v3/YOUR_INFURA_ID" // üîÅ –∑–∞–º—ñ–Ω–∏ –Ω–∞ —Å–≤—ñ–π RPC
    }
  });

  await wcProvider.enable();

  const provider = new ethers.providers.Web3Provider(wcProvider);
  signer = provider.getSigner();
  walletAddress = await signer.getAddress();
  document.getElementById("status").textContent = `‚úÖ WalletConnect: ${walletAddress}`;
}
</script>
<div class="section">
  <h3>üì± –í—ñ–¥–∫—Ä–∏—Ç–∏ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–æ–º—É</h3>
  <p>–°–∫–∞–Ω—É–π—Ç–µ QR-–∫–æ–¥, —â–æ–± –º–∏—Ç—Ç—î–≤–æ –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –º—ñ–Ω—Ç–∏–Ω–≥—É:</p>
  <img src="/media-kit/qr-mint.png" alt="QR Mint" />
</div>
